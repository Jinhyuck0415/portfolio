<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link href="../../static/assets/images/favicon.svg" rel="shortcut icon" type="image/x-icon"/>
    <title>MMH</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- ========== All CSS files linkup ========= -->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/lineicons.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/materialdesignicons.min.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/fullcalendar.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/main.css}"/>
</head>
<body>
<section class="table-components">
    <div class="container-fluid">
        <form th:action="@{/user/register}" th:method="post">
            <div class="form-elements-wrapper">
                <div class="row">
                    <div class="col-lg-6" style="margin: 10px auto">
                        <!-- input style start -->
                        <div class="card-style mb-30">
                            <h6 class="mb-25">회원가입</h6>
                            <div class="input-style-1">
                                <label>아이디
                                    <input class="addUser" id="userid" name="user_mem_id" placeholder="아이디" required
                                           type="text"/>
                                </label>
                            </div>
                            <div class="input-style-1">
                                <label>비밀번호
                                    <input class="addUser" id="password" name="password" placeholder="비밀번호" required
                                           type="password"/>
                                    <input class="addUser" id="password-retype" name="password2" placeholder="비밀번호 확인"
                                           required
                                           type="password"/>
                                </label>
                            </div>
                            <div class="input-style-1 row">
                                <label>이메일</label>
                                <div class="input-style-1 col-md-8 mb-0">
                                    <input class="addUser" name="user_mem_mail" placeholder="이메일 아이디" required
                                           style="width: 47%"
                                           type="text"/>@
                                    <input name="userMemMailDirect" placeholder="직접 입력" style="width: 47%" type="text"/>
                                </div>
                                <div class="select-style-1 col-md-4 mb-0">
                                    <div class="select-position">
                                        <select name="userMemMailSelect" required>
                                            <option selected value="none">선택 없음</option>
                                            <option value="naver.com">naver.com</option>
                                            <option value="gmail.com">gmail.com</option>
                                            <option value="daum.net">daum.net</option>
                                            <option value="yahoo.com">yahoo.com</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="input-style-1">
                                <label>이름
                                    <input class="addUser" name="user_mem_name" placeholder="이름" required type="text"/>
                                </label>
                            </div>
                            <div class="input-style-1">
                                <label>주소
                                    <input class="addUser" name="user_mem_address" placeholder="주소" required type="text"/>
                                </label>
                            </div>
                            <div class="input-style-1">
                                <label>전화번호
                                    <input class="addUser" name="user_mem_phone" placeholder="전화번호" required type="text"/>
                                </label>
                            </div>
                            <div class="row">
                                <div class="input-style-1">
                                    <label>나이
                                        <input class="addUser" name="user_mem_age" placeholder="나이" required type="text"/>
                                    </label>
                                </div>
                                <div class="select-style-1 ">
                                    <label>성별
                                        <div class="select-position">
                                            <select name="user_mem_gender" required>
                                                <option value="m">남자</option>
                                                <option value="w">여자</option>
                                                <option value="n">알리고 싶지 않음</option>
                                            </select>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div style="text-align: right">
                                <input class="main-btn primary-btn btn-hover" type="submit" value="가입 완료">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</section>
</body>
<script>
    // 1. 아이디 입력창 정보 가져오기
    let elInputUserName = document.querySelector('#userid');
    //2. 성공 메시지 정보 가져오기
    let elSuccessMessage = document.querySelector('.success-message');
    //3. 실패 메시지 정보 가져오기 (글자 수 제한 영문 20글자)
    let elFailureMessage = document.querySelector('.failure-message');
    //4. 실패 메시지2 정보 가져오기 (영어 또는 숫자 제한)
    let elFailureMessageTwo = document.querySelector('.failure-message2');

    //1. 비밀번호 입력창 정보 가져오기
    let elInputPassword = document.querySelector('#password');
    //2. 비밀번호 확인 입력창 정보 가져오기
    let elInputPasswordRetype = document.querySelector('#password-retype');
    //3. 실패 메시지 정보 가져오기 (비밀번호 불일치)
    let elMismatchMessage = document.querySelector('.mismatch-message');
    //4.실패 메시지 정보 가져오기(6글자 이상, 영문 숫자만 사용가능)
    let elStringPasswordMessage = documnet.querySelector(".strongPassword-message");

    function onlyNumberAndEnglish(str) {
        return /^[A-Za-z0-9][A-Za-z0-9]*$/.test(str);   //아이디에 영어 또는 숫자만 가능
    }

    function strongPassword(str) {
        return /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{6,}$/.test(str);
        //최소 6글자 이상이면서, 알파벳과 숫자 및 특수문자(@$!%*#?&)가 하나 이상 포함될 경우 true, 아니면 false를 리턴한다.
    }

    function isMatch(password1, password2) {
        return password1 === password2;
        //비밀번호와 비밀번호 확인이 일치할 경우 true, 아니면 false를 리턴한다.
    }

    document.querySelector('form').addEventListener('submit', function (event) {
        const userMemId = document.querySelector('input[name="userMemId"]').value;
        const userMemPw = document.querySelector('input[name="userMemPw"]').value;
        const userMemPw2 = document.querySelector('input[name="userMemPw2"]').value;
        const userMemAddress = document.querySelector('input[name="userMemAddress"]').value;
        const userMemName = document.querySelector('input[name="userMemName"]').value;
        const emailId = document.querySelector('input[name="userMemMail"]').value.trim(); // 아이디 부분
        const emailDirect = document.querySelector('input[name="userMemMailDirect"]').value.trim(); // 직접 입력 부분
        const emailSelect = document.querySelector('select[name="userMemMailSelect"]').value; // 선택된 도메인

        // 이메일 조합
        let email = '';
        if (emailDirect && emailSelect !== 'none') {
            email = `${emailId}@${emailDirect}`;
        } else if (emailSelect !== 'none') {
            email = `${emailId}@${emailSelect}`;
        } else {
            alert('도메인을 선택하거나 직접 입력하세요.');
            event.preventDefault(); // 폼 제출 방지
            return;
        }
        // 이메일 형식 확인
        if (!validateEmail(email)) {
            alert('잘못된 이메일 형식입니다.');
            event.preventDefault(); // 폼 제출 방지
            return;
        }

        // 필수 입력 확인
        if (!userMemId || !userMemPw || !userMemAddress || !userMemName || !emailId) {
            alert('아이디, 비밀번호, 주소, 이름, 이메일은 필수 입력 항목입니다.');
            event.preventDefault(); // 폼 제출 방지
            return;
        } else if (userMemPw !== userMemPw2) {
            alert('비밀번호와 비밀번호 확인이 일치하지 않습니다.');
            event.preventDefault(); // 폼 제출 방지
            return;
        } else if (!strongPassword(userMemPw)) {
            alert('비밀번호는 최소 6자 이상이며, 영문, 숫자, 특수문자를 포함해야 합니다.');
            event.preventDefault(); // 폼 제출 방지
            return;
        }
        // 이메일을 숨겨진 필드에 설정
        const hiddenEmailField = document.createElement('input');
        hiddenEmailField.type = 'hidden';
        hiddenEmailField.name = 'userMemMailFull';
        hiddenEmailField.value = email;
        document.querySelector('form').appendChild(hiddenEmailField);
    });

    function validateEmail(email) {
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // 기본 이메일 형식 정규 표현식
        return regex.test(email);
    }
</script>
</html>